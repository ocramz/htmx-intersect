<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTMX Intersect - Unload Demo</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="htmx-intersect.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        h2 {
            color: #667eea;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .demo-section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .spacer {
            height: 1000px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(to bottom, #f5f5f5 0%, #e0e0e0 100%);
            color: #999;
            font-size: 1.5rem;
            margin: 20px 0;
            border-radius: 8px;
        }

        /* Heavy Content Items */
        .heavy-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            margin: 10px 0;
            border-radius: 8px;
            min-height: 200px;
        }

        .heavy-item h3 {
            margin-bottom: 15px;
        }

        .heavy-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .heavy-content div {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 4px;
            text-align: center;
        }

        /* Skeleton/Placeholder */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
            padding: 30px;
            border-radius: 8px;
            margin: 10px 0;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Stats Dashboard */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Mode Comparison */
        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .mode-demo {
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
        }

        .mode-demo h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        /* Controls */
        .controls {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
        }

        button:hover {
            background: #5568d3;
        }

        code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        .info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .warning {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <header>
        <h1>‚ôªÔ∏è Content Unloading Demo</h1>
        <p>Efficiently manage memory in infinite scroll scenarios</p>
    </header>

    <div class="container">
        <!-- Introduction -->
        <div class="demo-section">
            <h2>üìñ What is Content Unloading?</h2>
            <p>
                When building infinite scroll experiences, the DOM can grow infinitely large, 
                consuming memory and slowing down your page. Content unloading automatically 
                removes or hides elements when they scroll out of view, keeping your page performant.
            </p>
            
            <div class="info">
                <strong>üí° Key Benefits:</strong>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Reduced memory usage in long lists</li>
                    <li>Better performance with thousands of items</li>
                    <li>Automatic content restoration when scrolling back</li>
                    <li>Configurable unload behavior</li>
                </ul>
            </div>
        </div>

        <!-- Stats Dashboard -->
        <div class="demo-section">
            <h2>üìä Live Stats</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">Elements in DOM</div>
                    <div class="stat-value" id="domCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Elements Loaded</div>
                    <div class="stat-value" id="loadedCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Elements Unloaded</div>
                    <div class="stat-value" id="unloadedCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Memory Impact</div>
                    <div class="stat-value" id="memoryImpact">Low</div>
                </div>
            </div>
        </div>

        <!-- Mode Comparison -->
        <div class="demo-section">
            <h2>üîÑ Unload Modes</h2>
            <p>Three different modes for different use cases:</p>

            <div class="mode-grid">
                <div class="mode-demo">
                    <h3>Mode: "remove"</h3>
                    <p>Completely removes element from DOM</p>
                    <code>intersect-unload="remove"</code>
                    <div class="info" style="margin-top: 10px; font-size: 0.9rem;">
                        Best for: One-time content, ads
                    </div>
                </div>

                <div class="mode-demo">
                    <h3>Mode: "content"</h3>
                    <p>Removes innerHTML, keeps element shell</p>
                    <code>intersect-unload="content"</code>
                    <div class="info" style="margin-top: 10px; font-size: 0.9rem;">
                        Best for: Lists, feeds (auto-restores)
                    </div>
                </div>

                <div class="mode-demo">
                    <h3>Mode: "hide"</h3>
                    <p>Sets display:none (fastest)</p>
                    <code>intersect-unload="hide"</code>
                    <div class="info" style="margin-top: 10px; font-size: 0.9rem;">
                        Best for: Quick toggle, maintains layout
                    </div>
                </div>
            </div>
        </div>

        <!-- Demo: Content Mode (Recommended) -->
        <div class="demo-section">
            <h2>üéØ Demo: Content Unloading (Recommended)</h2>
            <p>
                Scroll through these heavy items. They'll unload their content when you scroll past, 
                and automatically restore it when you scroll back up.
            </p>

            <div class="warning">
                <strong>‚ö†Ô∏è Instructions:</strong> Scroll down past all items, then scroll back up. 
                Watch the stats counter and notice how items reload their content.
            </div>

            <div class="spacer">‚Üì Scroll Down ‚Üì</div>

            <div class="heavy-item"
                 hx-ext="intersect"
                 intersect-unload="content"
                 intersect-unload-delay="500"
                 intersect-unload-placeholder="<div class='skeleton'>üîÑ Content unloaded (scroll back to restore)</div>"
                 data-hx-on:intersect:enter="updateStats()"
                 data-hx-on:intersect:exit="updateStats()">
                <h3>üì¶ Heavy Item #1</h3>
                <p>This item contains lots of data and DOM elements</p>
                <div class="heavy-content">
                    <div>Data 1</div>
                    <div>Data 2</div>
                    <div>Data 3</div>
                    <div>Data 4</div>
                    <div>Data 5</div>
                    <div>Data 6</div>
                    <div>Data 7</div>
                    <div>Data 8</div>
                </div>
            </div>

            <div class="heavy-item"
                 hx-ext="intersect"
                 intersect-unload="content"
                 intersect-unload-delay="500"
                 intersect-unload-placeholder="<div class='skeleton'>üîÑ Content unloaded (scroll back to restore)</div>"
                 data-hx-on:intersect:enter="updateStats()"
                 data-hx-on:intersect:exit="updateStats()">
                <h3>üì¶ Heavy Item #2</h3>
                <p>Even more heavy content here</p>
                <div class="heavy-content">
                    <div>Data 1</div>
                    <div>Data 2</div>
                    <div>Data 3</div>
                    <div>Data 4</div>
                    <div>Data 5</div>
                    <div>Data 6</div>
                    <div>Data 7</div>
                    <div>Data 8</div>
                </div>
            </div>

            <div class="heavy-item"
                 hx-ext="intersect"
                 intersect-unload="content"
                 intersect-unload-delay="500"
                 intersect-unload-placeholder="<div class='skeleton'>üîÑ Content unloaded (scroll back to restore)</div>"
                 data-hx-on:intersect:enter="updateStats()"
                 data-hx-on:intersect:exit="updateStats()">
                <h3>üì¶ Heavy Item #3</h3>
                <p>This pattern scales to thousands of items</p>
                <div class="heavy-content">
                    <div>Data 1</div>
                    <div>Data 2</div>
                    <div>Data 3</div>
                    <div>Data 4</div>
                    <div>Data 5</div>
                    <div>Data 6</div>
                    <div>Data 7</div>
                    <div>Data 8</div>
                </div>
            </div>

            <div class="heavy-item"
                 hx-ext="intersect"
                 intersect-unload="content"
                 intersect-unload-delay="500"
                 intersect-unload-placeholder="<div class='skeleton'>üîÑ Content unloaded (scroll back to restore)</div>"
                 data-hx-on:intersect:enter="updateStats()"
                 data-hx-on:intersect:exit="updateStats()">
                <h3>üì¶ Heavy Item #4</h3>
                <p>Memory usage stays constant</p>
                <div class="heavy-content">
                    <div>Data 1</div>
                    <div>Data 2</div>
                    <div>Data 3</div>
                    <div>Data 4</div>
                    <div>Data 5</div>
                    <div>Data 6</div>
                    <div>Data 7</div>
                    <div>Data 8</div>
                </div>
            </div>

            <div class="spacer">‚Üë Scroll Back Up ‚Üë</div>
        </div>

        <!-- Code Example -->
        <div class="demo-section">
            <h2>üíª Code Example</h2>
            <pre style="background: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 8px; overflow-x: auto;"><code>&lt;!-- Basic content unloading --&gt;
&lt;div hx-ext="intersect"
     intersect-unload="content"
     intersect-unload-delay="500"
     intersect-unload-placeholder="&lt;div class='loading'&gt;Removed&lt;/div&gt;"&gt;
  Heavy content here
&lt;/div&gt;

&lt;!-- Infinite scroll with unloading --&gt;
&lt;div id="feed"&gt;
  &lt;div class="post" 
       hx-ext="intersect"
       intersect-unload="content"
       intersect-margin="1000px"
       intersect-unload-delay="1000"&gt;
    Post content unloads when 1000px away
  &lt;/div&gt;
&lt;/div&gt;

&lt;!-- Load more trigger --&gt;
&lt;div hx-ext="intersect"
     hx-get="/api/more"
     hx-trigger="intersect once"
     hx-target="#feed"
     hx-swap="beforeend"&gt;
  Load more
&lt;/div&gt;</code></pre>
        </div>

        <!-- Use Cases -->
        <div class="demo-section">
            <h2>üéØ Use Cases</h2>
            
            <h3 style="color: #667eea; margin-top: 20px;">1. Infinite Scroll Feeds</h3>
            <p>Social media feeds, news feeds, product listings</p>
            <code>intersect-unload="content" intersect-margin="1500px"</code>

            <h3 style="color: #667eea; margin-top: 20px;">2. Image Galleries</h3>
            <p>Unload high-res images when not visible</p>
            <code>intersect-unload="content"</code>

            <h3 style="color: #667eea; margin-top: 20px;">3. Video Players</h3>
            <p>Stop and unload videos when scrolled past</p>
            <code>intersect-unload="hide"</code>

            <h3 style="color: #667eea; margin-top: 20px;">4. Advertisements</h3>
            <p>Remove ads after viewing</p>
            <code>intersect-unload="remove" intersect-unload-delay="5000"</code>

            <h3 style="color: #667eea; margin-top: 20px;">5. Virtual Lists</h3>
            <p>Render only visible items in very long lists</p>
            <code>intersect-unload="content" intersect-margin="500px"</code>
        </div>

        <!-- Best Practices -->
        <div class="demo-section">
            <h2>‚úÖ Best Practices</h2>
            
            <div class="info">
                <strong>DO:</strong>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Use <code>content</code> mode for restorable items</li>
                    <li>Set reasonable <code>intersect-margin</code> to unload distant items</li>
                    <li>Add <code>unload-delay</code> to prevent flicker during quick scrolls</li>
                    <li>Provide meaningful placeholder content</li>
                    <li>Test with thousands of items to verify performance gains</li>
                </ul>
            </div>

            <div class="warning" style="margin-top: 20px;">
                <strong>DON'T:</strong>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Use <code>remove</code> mode if users might scroll back</li>
                    <li>Set unload delay too low (causes flickering)</li>
                    <li>Unload items that are still partially visible</li>
                    <li>Forget to test scroll performance</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Stats tracking
        let loadedCount = 0;
        let unloadedCount = 0;

        function updateStats() {
            // Count actual heavy content in DOM
            const heavyItems = document.querySelectorAll('.heavy-content');
            const skeletons = document.querySelectorAll('.skeleton');
            
            loadedCount = heavyItems.length;
            unloadedCount = skeletons.length;
            
            document.getElementById('domCount').textContent = 
                document.querySelectorAll('*').length;
            document.getElementById('loadedCount').textContent = loadedCount;
            document.getElementById('unloadedCount').textContent = unloadedCount;
            
            // Memory impact estimation
            const total = loadedCount + unloadedCount;
            const percentage = total > 0 ? (loadedCount / total) * 100 : 0;
            
            let impact;
            if (percentage > 75) impact = 'High';
            else if (percentage > 40) impact = 'Medium';
            else impact = 'Low';
            
            document.getElementById('memoryImpact').textContent = impact;
        }

        // Listen to unload events
        document.addEventListener('intersect:beforeunload', (e) => {
            console.log('About to unload:', e.target);
        });

        document.addEventListener('intersect:unload', (e) => {
            console.log('Unloaded:', e.detail);
            updateStats();
        });

        // Initial stats
        updateStats();
        setInterval(updateStats, 1000);
    </script>
</body>
</html>
